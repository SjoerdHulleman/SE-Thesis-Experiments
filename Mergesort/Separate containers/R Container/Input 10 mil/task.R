setwd('/app')
start_run_time <- Sys.time()
library(optparse)
library(jsonlite)

library(httr)
library(jsonlite)
#library(Rcpp)
library(readr)



print('option_list')
option_list = list(

)


opt = parse_args(OptionParser(option_list=option_list))

var_serialization <- function(var){
    if (is.null(var)){
        print("Variable is null")
        exit(1)
    }
    tryCatch(
        {
            var <- fromJSON(var)
            print("Variable deserialized")
            return(var)
        },
        error=function(e) {
            print("Error while deserializing the variable")
            print(var)
            var <- gsub("'", '"', var)
            var <- fromJSON(var)
            print("Variable deserialized")
            return(var)
        },
        warning=function(w) {
            print("Warning while deserializing the variable")
            var <- gsub("'", '"', var)
            var <- fromJSON(var)
            print("Variable deserialized")
            return(var)
        }
    )
}



print("Running the cell")
library(jsonlite)
library(httr)
library(readr)
# ----- End of libraries ----- #


start_run_time <- Sys.time()
#library(Rcpp)

#sourceCpp("merge_sort.cpp")

print("Loading array")
arr <- load("ten_million_array.rda")
print("Loaded array")
head(int_arr)

# sorted_arr <- mergeSort(int_arr)
# ----- THIS CODE IS AUTO-GENERATED BY MULTICONTAINERIZER ----- #
{# Convert each param to JSON format
start_func_time <- Sys.time()
json_arr <- toJSON(as.vector(int_arr))

# Prepare a list for JSON conversion
list_sorted_arr <- list(
	arr = json_arr
)
# Convert to JSON format
json_sorted_arr <- toJSON(list_sorted_arr, auto_unbox=TRUE)
# URL dependent on configuration
url_sorted_arr <- "http://localhost:8080/mergeSort"

# Call the correct API endpoint for this function and process the result
response_sorted_arr <- POST(
	url_sorted_arr,
	body = json_sorted_arr,
	encode = "raw",
	add_headers("Content-Type" = "application/json")
)
end_func_time <- Sys.time()

content_sorted_arr <- content(response_sorted_arr)

# Capture the results in the original variable, and convert into correct format
sorted_arr <- as.vector(content_sorted_arr)
sorted_arr <- as.vector(as.numeric(sorted_arr))
}# ---- END OF AUTO-GENERATED CODE ----- #

end_run_time <- Sys.time()

print("Execution COMPLETED")

head(sorted_arr)

run_time <- as.numeric(end_run_time - start_run_time, units = "secs")
func_time <- as.numeric(end_func_time - start_func_time, units = "secs")

print(paste("Run time: ", run_time))
print(paste("Func time: ", func_time))
